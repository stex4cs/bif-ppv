<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ BIF PPV - Enterprise Admin Panel</title>
    <style>
        /* Svi postojeƒái stilovi ostaju isti */
        :root {
            --primary: #c41e3a;
            --secondary: #8b0000;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --border: #dee2e6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        .admin-container {
            display: grid;
            grid-template-areas: 
                "sidebar header"
                "sidebar main";
            grid-template-columns: 280px 1fr;
            grid-template-rows: 70px 1fr;
            height: 100vh;
        }

        /* SIDEBAR */
        .sidebar {
            grid-area: sidebar;
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            color: white;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-group {
            margin-bottom: 30px;
        }

        .nav-group-title {
            padding: 0 20px 10px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            font-weight: 600;
        }

        .nav-item {
            display: block;
            padding: 12px 20px;
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(255,255,255,0.1);
            border-left-color: #ffd700;
            color: white;
        }

        .nav-item i {
            width: 20px;
            margin-right: 10px;
        }

        /* HEADER */
        .header {
            grid-area: header;
            background: white;
            padding: 0 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .header-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--success);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* MAIN CONTENT */
        .main-content {
            grid-area: main;
            padding: 30px;
            overflow-y: auto;
            background: #f5f7fa;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CARDS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-left: 4px solid var(--primary);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-change {
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* TABLES */
        .data-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .table-header {
            padding: 20px 25px;
            background: var(--light);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .table-responsive {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #f8f9fa;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        /* BUTTONS */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* BADGES */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info);
        }

        /* FORMS */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-control-sm {
            padding: 8px 12px;
            font-size: 12px;
        }

        /* ALERTS */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-success {
            background: rgba(40, 167, 69, 0.1);
            border-left-color: var(--success);
            color: #155724;
        }

        .alert-danger {
            background: rgba(220, 53, 69, 0.1);
            border-left-color: var(--danger);
            color: #721c24;
        }

        .alert-warning {
            background: rgba(255, 193, 7, 0.1);
            border-left-color: var(--warning);
            color: #856404;
        }

        .alert-info {
            background: rgba(23, 162, 184, 0.1);
            border-left-color: var(--info);
            color: #0c5460;
        }

        /* MODALS */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* LOADING */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .admin-container {
                grid-template-areas: 
                    "header"
                    "main";
                grid-template-columns: 1fr;
                grid-template-rows: 70px 1fr;
            }

            .sidebar {
                display: none;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* NOTIFICATION SYSTEM */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 9999;
            animation: slideIn 0.3s ease;
            min-width: 300px;
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
            color: var(--dark);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tinymce@6/tinymce.min.js"></script>
</head>
<body>
    <div class="admin-container">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>ü•ä BIF PPV</h2>
                <p>Enterprise Admin</p>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-group">
                    <div class="nav-group-title">OVERVIEW</div>
                    <a href="#" class="nav-item active" data-section="dashboard">
                        <i>üìä</i> Dashboard
                    </a>
                    <a href="#" class="nav-item" data-section="analytics">
                        <i>üìà</i> Live Analytics
                    </a>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">CONTENT</div>
                    <a href="#" class="nav-item" data-section="events">
                        <i>üé¨</i> Event Management
                    </a>
<div class="nav-group">
    <div class="nav-group-title">SADR≈ΩAJ</div>
    <a href="#" class="nav-item" data-section="hero-settings">
        <i>üé¨</i> Hero Sekcija
    </a>
    <a href="#" class="nav-item" data-section="fighters">
        <i>ü•ä</i> Borci
    </a>
    <a href="#" class="nav-item" data-section="content-news">
        <i>üì∞</i> Vesti
    </a>
    <a href="#" class="nav-item" data-section="website-events">
        <i>üé™</i> Dogaƒëaji
    </a>
</div>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">CUSTOMERS</div>
                    <a href="#" class="nav-item" data-section="purchases">
                        <i>üí∞</i> Purchase History
                    </a>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">SECURITY</div>
                    <a href="#" class="nav-item" data-section="violations">
                        <i>üö®</i> Violations
                    </a>
                    <a href="#" class="nav-item" data-section="access">
                        <i>üîë</i> Access Control
                    </a>
                </div>
            </nav>
        </div>

        <!-- HEADER -->
        <div class="header">
            <div class="header-title">BIF PPV Live Admin Panel</div>
            <div class="header-actions">
                <div class="live-indicator">
                    <div class="live-dot"></div>
                    <span>LIVE DATA</span>
                </div>
                <span id="current-time"></span>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- DASHBOARD SECTION -->
            <div id="dashboard" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #28a745, #20c997);">üí∞</div>
                        </div>
                        <div class="stat-number" id="total-revenue">Loading...</div>
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-change positive" id="revenue-change">Calculating...</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #007bff, #0056b3);">üõí</div>
                        </div>
                        <div class="stat-number" id="total-purchases">Loading...</div>
                        <div class="stat-label">Total Purchases</div>
                        <div class="stat-change positive" id="purchases-change">Calculating...</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #ffc107, #e0a800);">üé¨</div>
                        </div>
                        <div class="stat-number" id="active-events">Loading...</div>
                        <div class="stat-label">Active Events</div>
                        <div class="stat-change positive" id="events-change">Calculating...</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #dc3545, #c82333);">üë•</div>
                        </div>
                        <div class="stat-number" id="active-viewers">Loading...</div>
                        <div class="stat-label">Active Viewers</div>
                        <div class="stat-change positive" id="viewers-change">Live tracking...</div>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">Recent Activity (Live)</div>
                        <div class="table-actions">
                            <button class="btn btn-sm btn-primary" onclick="adminPanel.refreshData()">üîÑ Refresh</button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Activity</th>
                                    <th>User</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recent-activity">
                                <tr>
                                    <td colspan="5" class="loading">
                                        <div class="spinner"></div>
                                        Loading live data...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- EVENTS SECTION -->
            <div id="events" class="content-section">
                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">Live Event Management</div>
                        <div class="table-actions">
                            <button class="btn btn-primary" onclick="showCreateEventModal()">
                                ‚ûï Create New Event
                            </button>
                            <button class="btn btn-success btn-sm" onclick="adminPanel.exportEvents()">
                                üìÑ Export
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Event</th>
                                    <th>Date</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Sales</th>
                                    <th>Revenue</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="events-table">
                                <tr>
                                    <td colspan="7" class="loading">
                                        <div class="spinner"></div>
                                        Loading events...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- PURCHASES SECTION -->
            <div id="purchases" class="content-section">
                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">Live Purchase History</div>
                        <div class="table-actions">
                            <button class="btn btn-success btn-sm" onclick="adminPanel.exportPurchases()">üìÑ Export All</button>
                            <button class="btn btn-primary btn-sm" onclick="adminPanel.refreshPurchases()">üîÑ Refresh</button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Purchase ID</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Event</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="purchases-table">
                                <tr>
                                    <td colspan="7" class="loading">
                                        <div class="spinner"></div>
                                        Loading purchases...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ANALYTICS SECTION -->
            <div id="analytics" class="content-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #28a745, #20c997);">üìà</div>
                        </div>
                        <div class="stat-number" id="today-revenue">Loading...</div>
                        <div class="stat-label">Today's Revenue</div>
                        <div class="stat-change positive" id="today-change">vs yesterday</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #007bff, #0056b3);">üë•</div>
                        </div>
                        <div class="stat-number" id="concurrent-viewers">Loading...</div>
                        <div class="stat-label">Concurrent Viewers</div>
                        <div class="stat-change positive" id="viewers-trend">Peak tracking</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #ffc107, #e0a800);">üéØ</div>
                        </div>
                        <div class="stat-number" id="conversion-rate">Loading...</div>
                        <div class="stat-label">Conversion Rate</div>
                        <div class="stat-change positive" id="conversion-trend">Optimization</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #dc3545, #c82333);">‚è±Ô∏è</div>
                        </div>
                        <div class="stat-number" id="avg-watch-time">Loading...</div>
                        <div class="stat-label">Avg Watch Time</div>
                        <div class="stat-change positive" id="watch-trend">Engagement</div>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">Live Performance Metrics</div>
                        <div class="table-actions">
                            <div class="live-indicator">
                                <div class="live-dot"></div>
                                <span>LIVE</span>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Current</th>
                                    <th>Peak</th>
                                    <th>Average</th>
                                    <th>Trend</th>
                                </tr>
                            </thead>
                            <tbody id="analytics-table">
                                <tr>
                                    <td colspan="5" class="loading">
                                        <div class="spinner"></div>
                                        Loading analytics...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIOLATIONS SECTION -->
            <div id="violations" class="content-section">
                <div class="alert alert-info">
                    <strong>üõ°Ô∏è Security Status:</strong> Live monitoring enabled. All violations tracked in real-time.
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #ffc107, #e0a800);">‚ö†Ô∏è</div>
                        </div>
                        <div class="stat-number" id="violations-count">Loading...</div>
                        <div class="stat-label">Security Violations</div>
                        <div class="stat-change" id="violations-trend">Last 24 hours</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #dc3545, #c82333);">üö´</div>
                        </div>
                        <div class="stat-number" id="blocked-attempts">Loading...</div>
                        <div class="stat-label">Blocked Attempts</div>
                        <div class="stat-change" id="blocked-trend">Auto-blocked</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #28a745, #20c997);">üîí</div>
                        </div>
                        <div class="stat-number" id="protection-rate">Loading...</div>
                        <div class="stat-label">Protection Rate</div>
                        <div class="stat-change positive">DRM Effectiveness</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: linear-gradient(45deg, #007bff, #0056b3);">üëÅÔ∏è</div>
                        </div>
                        <div class="stat-number">1</div>
                        <div class="stat-label">Max Devices</div>
                        <div class="stat-change">Per customer</div>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">Live Security Violations</div>
                        <div class="table-actions">
                            <button class="btn btn-danger btn-sm" onclick="adminPanel.clearViolations()">üóëÔ∏è Clear All</button>
                            <button class="btn btn-warning btn-sm" onclick="adminPanel.exportViolations()">üìÑ Export Report</button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Type</th>
                                    <th>User</th>
                                    <th>Device</th>
                                    <th>Severity</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="violations-table">
                                <tr>
                                    <td colspan="6" class="loading">
                                        <div class="spinner"></div>
                                        Loading violations...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ACCESS CONTROL SECTION -->
            <div id="access" class="content-section">
                <div class="data-table">
                    <div class="table-header">
                        <div class="table-title">Live Access Control</div>
                        <div class="table-actions">
                            <button class="btn btn-success btn-sm" onclick="adminPanel.exportAccess()">üìÑ Export Access</button>
                            <button class="btn btn-primary btn-sm" onclick="adminPanel.refreshAccess()">üîÑ Refresh</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CONTENT MANAGEMENT SECTIONS -->

            <!-- HERO SETTINGS SECTION -->
            <div id="hero-settings" class="content-section">
                <div class="section-header">
                    <h2>üé¨ Hero Sekcija (Video i Tajmer)</h2>
                    <button class="btn btn-success" onclick="saveHeroSettings()">
                        üíæ Saƒçuvaj Promene
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>YouTube Video</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="hero-video-url">YouTube Embed URL</label>
                            <input type="text" id="hero-video-url" class="form-control"
                                   placeholder="https://www.youtube.com/embed/VIDEO_ID">
                            <small class="form-text">Primer: https://www.youtube.com/embed/PwjZeFIpxvo?rel=0&controls=1&autoplay=0</small>
                        </div>

                        <div id="video-preview" style="margin-top: 20px;">
                            <strong>Pregled videa:</strong>
                            <div style="max-width: 560px; margin-top: 10px;">
                                <iframe id="preview-iframe" width="100%" height="315" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <h3>Countdown Timer</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="hero-countdown-date">Datum i vreme dogaƒëaja</label>
                            <input type="datetime-local" id="hero-countdown-date" class="form-control">
                            <small class="form-text">Izaberi datum i vreme do kog ƒáe tajmer odbrojati</small>
                        </div>

                        <div class="row" style="margin-top: 20px;">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="hero-countdown-title-sr">Naslov (Srpski)</label>
                                    <input type="text" id="hero-countdown-title-sr" class="form-control"
                                           placeholder="Do BIF 1">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="hero-countdown-title-en">Naslov (Engleski)</label>
                                    <input type="text" id="hero-countdown-title-en" class="form-control"
                                           placeholder="Until BIF 1">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px; background-color: #f8f9fa;">
                    <div class="card-body">
                        <h4>‚ÑπÔ∏è Uputstvo</h4>
                        <ul>
                            <li><strong>YouTube URL:</strong> Kopiraj "Embed" link iz YouTube videa (Share ‚Üí Embed)</li>
                            <li><strong>Countdown:</strong> Postavi datum i vreme kada se dogaƒëaj odr≈æava</li>
                            <li><strong>Promene se prikazuju odmah</strong> na index.php stranici posle ƒçuvanja</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="fighters" class="content-section">
    <div class="section-header">
        <h2>ü•ä Upravljanje Borcima</h2>
        <button class="btn btn-primary" onclick="openCreateFighterModal()">
            + Dodaj Borca
        </button>
    </div>

    <div class="card">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Slika</th>
                    <th>Ime</th>
                    <th>Nadimak</th>
                    <th>Te≈æina</th>
                    <th>Visina</th>
                    <th>Kategorija</th>
                    <th>Rekord</th>
                    <th>Status</th>
                    <th>Akcije</th>
                </tr>
            </thead>
            <tbody id="fighters-table">
                <tr><td colspan="9" style="text-align:center;padding:40px;">Loading fighters...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div id="content-news" class="content-section">
    <div class="section-header">
        <h2>üì∞ Upravljanje Vestima</h2>
        <button class="btn btn-primary" onclick="openCreateNewsModal()">
            + Dodaj Vest
        </button>
    </div>

    <div class="card">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Naslov</th>
                    <th>Kategorija</th>
                    <th>Datum objave</th>
                    <th>Status</th>
                    <th>Akcije</th>
                </tr>
            </thead>
            <tbody id="news-table">
                <tr><td colspan="5" style="text-align:center;padding:40px;">Loading news...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div id="website-events" class="content-section">
    <div class="section-header">
        <h2>üé™ Upravljanje Dogaƒëajima</h2>
        <button class="btn btn-primary" onclick="openCreateWebsiteEventModal()">
            + Dodaj Dogaƒëaj
        </button>
    </div>

    <div class="card">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Naziv</th>
                    <th>Datum</th>
                    <th>Lokacija</th>
                    <th>Status</th>
                    <th>Akcije</th>
                </tr>
            </thead>
            <tbody id="website-events-table">
                <tr><td colspan="5" style="text-align:center;padding:40px;">Loading events...</td></tr>
            </tbody>
        </table>
    </div>
</div>

        </div>
        <!-- END MAIN CONTENT -->

    <!-- CREATE EVENT MODAL -->
    <!-- Create/Edit Fighter Modal -->
<div id="fighterModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2 id="fighter-modal-title">Dodaj Borca</h2>
            <span class="close" onclick="closeFighterModal()">&times;</span>
        </div>
        <form id="fighterForm" onsubmit="saveFighter(event)">
            <input type="hidden" id="fighter-id" name="id">

            <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                <div class="form-group">
                    <label for="fighter-name">Ime i prezime *</label>
                    <input type="text" id="fighter-name" name="name" required placeholder="Marko Milovanoviƒá">
                </div>
                <div class="form-group">
                    <label for="fighter-nickname">Nadimak *</label>
                    <input type="text" id="fighter-nickname" name="nickname" required placeholder="Jack">
                </div>
            </div>

            <div class="form-group">
                <label for="fighter-slug">URL Slug * (npr: marko-jack)</label>
                <input type="text" id="fighter-slug" name="slug" required placeholder="marko-jack" pattern="[a-z0-9-]+">
                <small>Samo mala slova, brojevi i crtice. Koristi se za URL.</small>
            </div>

            <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;">
                <div class="form-group">
                    <label for="fighter-weight">Te≈æina (kg)</label>
                    <input type="number" id="fighter-weight" name="weight" placeholder="100">
                </div>
                <div class="form-group">
                    <label for="fighter-height">Visina (cm)</label>
                    <input type="number" id="fighter-height" name="height" placeholder="180">
                </div>
                <div class="form-group">
                    <label for="fighter-age">Godine</label>
                    <input type="number" id="fighter-age" name="age" placeholder="33">
                </div>
            </div>

            <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;">
                <div class="form-group">
                    <label for="fighter-wins">Pobede</label>
                    <input type="number" id="fighter-wins" name="wins" placeholder="10" value="0">
                </div>
                <div class="form-group">
                    <label for="fighter-losses">Porazi</label>
                    <input type="number" id="fighter-losses" name="losses" placeholder="2" value="0">
                </div>
                <div class="form-group">
                    <label for="fighter-draws">Nereseno</label>
                    <input type="number" id="fighter-draws" name="draws" placeholder="0" value="0">
                </div>
            </div>

            <div class="form-group">
                <label for="fighter-weight-class">Kategorija te≈æine</label>
                <select id="fighter-weight-class" name="weight_class">
                    <option value="">Auto (prema te≈æini)</option>
                    <option value="flyweight">Mu≈°iƒçja te≈æina / Flyweight (do 57kg)</option>
                    <option value="bantamweight">Pijevƒçija te≈æina / Bantamweight (do 61kg)</option>
                    <option value="featherweight">Perjana te≈æina / Featherweight (do 66kg)</option>
                    <option value="lightweight">Laka te≈æina / Lightweight (do 70kg)</option>
                    <option value="welterweight">Polu-srednja te≈æina / Welterweight (do 77kg)</option>
                    <option value="middleweight">Srednja te≈æina / Middleweight (do 84kg)</option>
                    <option value="light-heavyweight">Polu-te≈°ka te≈æina / Light Heavyweight (do 93kg)</option>
                    <option value="heavyweight">Te≈°ka te≈æina / Heavyweight (do 120kg)</option>
                    <option value="super-heavyweight">Superte≈°ka kategorija / Super Heavyweight (120kg+)</option>
                </select>
                <small>Ako nije izabrano, kategorija se automatski odreƒëuje prema te≈æini.</small>
            </div>

            <div class="form-group">
                <label for="fighter-bio">Biografija</label>
                <textarea id="fighter-bio" name="bio" rows="4" placeholder="Opis borca..."></textarea>
            </div>

            <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                <div class="form-group">
                    <label for="fighter-image">URL Slike</label>
                    <input type="text" id="fighter-image" name="image_url" placeholder="/assets/images/fighters/fighter.png">
                </div>
                <div class="form-group">
                    <label for="fighter-status">Status</label>
                    <select id="fighter-status" name="status">
                        <option value="active">Aktivan</option>
                        <option value="inactive">Neaktivan</option>
                    </select>
                </div>
            </div>

            <div class="form-actions" style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px;">
                <button type="button" class="btn" onclick="closeFighterModal()">Otka≈æi</button>
                <button type="submit" class="btn btn-primary">Saƒçuvaj</button>
            </div>
        </form>
    </div>
</div>

<!-- Create/Edit News Modal -->
<div id="newsModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2 id="news-modal-title">Dodaj Vest</h2>
            <span class="close" onclick="closeNewsModal()">&times;</span>
        </div>
        <form id="newsForm" onsubmit="saveNews(event)">
            <input type="hidden" id="news-id" name="id">

            <!-- General Settings Section -->
            <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                <h3 style="margin-top: 0; font-size: 16px; color: #333;">Op≈°ta pode≈°avanja</h3>

                <div class="form-group">
                    <label for="news-slug">URL Slug * (npr: bif-2-najava)</label>
                    <input type="text" id="news-slug" name="slug" required placeholder="bif-2-najava" pattern="[a-z0-9-]+">
                    <small>Samo mala slova, brojevi i crtice.</small>
                </div>

                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                    <div class="form-group">
                        <label for="news-category">Kategorija</label>
                        <select id="news-category" name="category">
                            <option value="news">Vesti</option>
                            <option value="announcement">Najave</option>
                            <option value="results">Rezultati</option>
                            <option value="other">Ostalo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="news-image">URL Slike</label>
                        <input type="text" id="news-image" name="image_url" placeholder="/assets/images/news/news-1.png">
                    </div>
                </div>

                <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                    <div class="form-group">
                        <label for="news-published-at">Datum objave</label>
                        <input type="datetime-local" id="news-published-at" name="published_at">
                    </div>
                    <div class="form-group">
                        <label for="news-status">Status</label>
                        <select id="news-status" name="status">
                            <option value="published">Objavljeno</option>
                            <option value="draft">Draft</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Language Tabs -->
            <div class="news-lang-tabs" style="display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid #ddd;">
                <button type="button" class="news-lang-tab active" onclick="switchNewsLangTab('sr')" data-lang="sr" style="background: none; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; border-bottom: 3px solid #e31937; color: #e31937;">
                    üá∑üá∏ Srpski (SR)
                </button>
                <button type="button" class="news-lang-tab" onclick="switchNewsLangTab('en')" data-lang="en" style="background: none; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; border-bottom: 3px solid transparent; color: #666;">
                    üá¨üáß English (EN)
                </button>
            </div>

            <!-- Serbian Content -->
            <div id="news-tab-sr" class="news-lang-content active">
                <div class="form-group">
                    <label for="news-title-sr">Naslov (Srpski) *</label>
                    <input type="text" id="news-title-sr" name="title_sr" required placeholder="BIF 2 - Najava dogaƒëaja">
                </div>

                <div class="form-group">
                    <label for="news-excerpt-sr">Kratak opis (Srpski)</label>
                    <textarea id="news-excerpt-sr" name="excerpt_sr" rows="2" placeholder="Kratak opis vesti na srpskom..."></textarea>
                </div>

                <div class="form-group">
                    <label for="news-content-sr">Sadr≈æaj (Srpski) *</label>
                    <textarea id="news-content-sr" name="content_sr" rows="10"></textarea>
                    <small>Koristite toolbar za formatiranje: Bold, Italic, naslove, liste, itd.</small>
                </div>
            </div>

            <!-- English Content -->
            <div id="news-tab-en" class="news-lang-content" style="display: none;">
                <div class="form-group">
                    <label for="news-title-en">Title (English) *</label>
                    <input type="text" id="news-title-en" name="title_en" required placeholder="BIF 2 - Event Announcement">
                </div>

                <div class="form-group">
                    <label for="news-excerpt-en">Short Description (English)</label>
                    <textarea id="news-excerpt-en" name="excerpt_en" rows="2" placeholder="Short description in English..."></textarea>
                </div>

                <div class="form-group">
                    <label for="news-content-en">Content (English) *</label>
                    <textarea id="news-content-en" name="content_en" rows="10"></textarea>
                    <small>Use the toolbar for formatting: Bold, Italic, headings, lists, etc.</small>
                </div>
            </div>

            <div class="form-actions" style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px;">
                <button type="button" class="btn" onclick="closeNewsModal()">Otka≈æi</button>
                <button type="submit" class="btn btn-primary">Saƒçuvaj</button>
            </div>
        </form>
    </div>
</div>

<!-- Create/Edit Website Event Modal -->
<div id="websiteEventModal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <h2 id="website-event-modal-title">Dodaj Dogaƒëaj</h2>
            <span class="close" onclick="closeWebsiteEventModal()">&times;</span>
        </div>
        <form id="websiteEventForm" onsubmit="saveWebsiteEvent(event)">
            <input type="hidden" id="website-event-id" name="id">

            <div class="form-group">
                <label for="website-event-title">Naziv dogaƒëaja *</label>
                <input type="text" id="website-event-title" name="title" required placeholder="BIF 2: Showdown">
            </div>

            <div class="form-group">
                <label for="website-event-slug">URL Slug * (npr: bif-2-showdown)</label>
                <input type="text" id="website-event-slug" name="slug" required placeholder="bif-2-showdown" pattern="[a-z0-9-]+">
            </div>

            <div class="form-group">
                <label for="website-event-description">Opis</label>
                <textarea id="website-event-description" name="description" rows="4" placeholder="Opis dogaƒëaja..."></textarea>
            </div>

            <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                <div class="form-group">
                    <label for="website-event-date">Datum *</label>
                    <input type="datetime-local" id="website-event-date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="website-event-location">Lokacija</label>
                    <input type="text" id="website-event-location" name="location" placeholder="Beograd Arena">
                </div>
            </div>

            <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                <div class="form-group">
                    <label for="website-event-image">URL Slike</label>
                    <input type="text" id="website-event-image" name="image_url" placeholder="/assets/images/events/event-1.jpg">
                </div>
                <div class="form-group">
                    <label for="website-event-status">Status</label>
                    <select id="website-event-status" name="status">
                        <option value="upcoming">Predstojeƒái</option>
                        <option value="live">U≈æivo</option>
                        <option value="finished">Zavr≈°en</option>
                        <option value="cancelled">Otkazan</option>
                    </select>
                </div>
            </div>

            <div class="form-actions" style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px;">
                <button type="button" class="btn" onclick="closeWebsiteEventModal()">Otka≈æi</button>
                <button type="submit" class="btn btn-primary">Saƒçuvaj</button>
            </div>
        </form>
    </div>
</div>

<div id="createEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üé¨ Create New Event</div>
                <button class="modal-close" onclick="hideCreateEventModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="createEventForm">
                    <div class="form-group">
                        <label class="form-label">Event Title</label>
                        <input type="text" id="event-title" class="form-control" name="title" required placeholder="e.g., BIF 2: Ultimate Showdown">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="event-description" class="form-control" name="description" rows="4" placeholder="Event description..."></textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">Event Date</label>
                            <input type="datetime-local" id="event-date" class="form-control" name="date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price (RSD)</label>
                            <input type="number" id="event-price" class="form-control" name="price" step="0.01" value="1999" required>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">Early Bird Price (RSD)</label>
                            <input type="number" id="event-early-price" class="form-control" name="early_bird_price" step="0.01" value="1499">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Early Bird Until</label>
                            <input type="datetime-local" id="event-early-until" class="form-control" name="early_bird_until">
                        </div>
                    </div>
                    <div class="form-group">
    <label class="form-label">Stream URL</label>
    <input type="url" id="event-stream-url" class="form-control" name="stream_url" 
           placeholder="https://your-stream-url.com/stream.m3u8" required>
    <small class="form-text text-muted">
        AWS MediaLive, YouTube Live, Vimeo, ili bilo koji drugi streaming URL
    </small>
</div>
                    <div class="form-group">
                        <label class="form-label">Poster Image URL</label>
                        <input type="url" id="event-poster" class="form-control" name="poster_image" placeholder="https://...">
                        <input type="hidden" id="event-id" name="id">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="event-status" class="form-control" name="status">
                            <option value="upcoming">Upcoming</option>
                            <option value="live">Live</option>
                            <option value="finished">Finished</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideCreateEventModal()">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveNewEvent()">Create Event</button>
            </div>
        </div>
    </div>

    <script>
        // ========== TINYMCE INITIALIZATION ==========
        let tinyMCEInitialized = false;

        function initTinyMCE() {
            if (tinyMCEInitialized) return;

            tinymce.init({
                selector: '#news-content-sr, #news-content-en',
                height: 400,
                menubar: false,
                plugins: 'lists link code fullscreen table wordcount',
                toolbar: 'undo redo | blocks | bold italic | alignleft aligncenter alignright | bullist numlist | removeformat code',
                content_style: 'body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; font-size: 14px; line-height: 1.6; }',
                block_formats: 'Paragraph=p; Heading 1=h1; Heading 2=h2; Heading 3=h3',
                branding: false,
                promotion: false,
                setup: function(editor) {
                    editor.on('init', function() {
                        console.log('‚úÖ TinyMCE editor initialized:', editor.id);
                    });
                }
            });

            tinyMCEInitialized = true;
        }

        // Initialize TinyMCE when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for TinyMCE to be available
            if (typeof tinymce !== 'undefined') {
                initTinyMCE();
            } else {
                console.warn('‚ö†Ô∏è TinyMCE not loaded yet, will retry...');
                setTimeout(initTinyMCE, 1000);
            }
        });

        // üöÄ LIVE ADMIN PANEL - POTPUNA INTEGRACIJA SA PPV.PHP
        class LiveAdminPanel {
            constructor() {
                this.apiUrl = 'ppv_admin.php'; // Admin API
                this.ppvApiUrl = 'api/ppv.php'; // Main PPV API
                this.currentSection = 'dashboard';
                this.events = [];
                this.purchases = [];
                this.access = [];
                this.violations = [];
                this.stats = {};
                this.realTimeInterval = null;
                this.init();
            }

            init() {
                this.bindNavigationEvents();
                this.startRealTimeUpdates();
                this.loadAllData();
                this.updateClock();
                console.log('üöÄ Live Admin Panel initialized');
            }

            bindNavigationEvents() {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.getAttribute('data-section');
                        this.showSection(section);
                        
                        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                        item.classList.add('active');
                    });
                });
            }

            showSection(sectionName) {
                console.log(`üîÑ showSection called for: ${sectionName}`);
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });

                const targetSection = document.getElementById(sectionName);
                console.log('üéØ Target section element:', targetSection);
                if (targetSection) {
                    targetSection.classList.add('active');
                    console.log(`‚úÖ Added 'active' class to #${sectionName}`);
                    console.log('üìã Section classes:', targetSection.className);
                    this.currentSection = sectionName;
                    this.loadSectionData(sectionName);
                } else {
                    console.error(`‚ùå Section #${sectionName} not found!`);
                }
            }

            async loadSectionData(section) {
                console.log(`üìä Loading live data for section: ${section}`);

                switch(section) {
                    case 'dashboard':
                        await this.loadDashboardData();
                        break;
                    case 'events':
                        await this.loadEventsData();
                        break;
                    case 'purchases':
                        await this.loadPurchasesData();
                        break;
                    case 'analytics':
                        await this.loadAnalyticsData();
                        break;
                    case 'violations':
                        await this.loadViolationsData();
                        break;
                    case 'access':
                        await this.loadAccessData();
                        break;
                    case 'hero-settings':
                        console.log('üé¨ Loading hero settings section...');
                        await loadHeroSettings();
                        console.log('‚úÖ Hero settings loaded');
                        break;
                    case 'fighters':
                        console.log('ü•ä Loading fighters section...');
                        await loadFighters();
                        console.log('‚úÖ Fighters loaded');
                        break;
                    case 'content-news':
                        console.log('üì∞ Loading news section...');
                        await loadContentNews();
                        console.log('‚úÖ News loaded');
                        break;
                    case 'website-events':
                        console.log('üé™ Loading website events section...');
                        await loadWebsiteEvents();
                        console.log('‚úÖ Website events loaded');
                        break;
                }
            }

            // üîÑ LIVE DATA LOADING METHODS
            async loadAllData() {
                console.log('üì° Loading ALL live data...');
                try {
                    // Load real data from APIs
                    await Promise.all([
                        this.loadRealEvents(),
                        this.loadRealPurchases(),
                        this.loadRealStats(),
                        this.loadRealAccess(),
                        this.loadRealViolations()
                    ]);
                    
                    this.updateDashboardStats();
                    this.updateRecentActivity();
                    console.log('‚úÖ All live data loaded successfully');
                    
                } catch (error) {
                    console.error('‚ùå Error loading live data:', error);
                    this.showNotification('Error loading live data: ' + error.message, 'error');
                }
            }

            async loadRealEvents() {
                try {
                    console.log('üé¨ Loading real events...');
                    const response = await fetch(`${this.apiUrl}?action=get_events`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.events = data.events;
                        console.log(`‚úÖ Loaded ${this.events.length} real events`);
                        this.updateEventsTable();
                    } else {
                        throw new Error(data.error);
                    }
                } catch (error) {
                    console.error('‚ùå Error loading events:', error);
                    this.events = [];
                }
            }

            async loadRealPurchases() {
                try {
                    console.log('üí∞ Loading real purchases...');
                    const response = await fetch(`${this.apiUrl}?action=get_purchases`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.purchases = data.purchases;
                        console.log(`‚úÖ Loaded ${this.purchases.length} real purchases`);
                        this.updatePurchasesTable();
                    } else {
                        console.log('‚ö†Ô∏è No purchases data available');
                        this.purchases = [];
                    }
                } catch (error) {
                    console.error('‚ùå Error loading purchases:', error);
                    this.purchases = [];
                }
            }

            async loadRealStats() {
                try {
                    console.log('üìä Loading real stats...');
                    const response = await fetch(`${this.apiUrl}?action=get_stats`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.stats = data.stats;
                        console.log('‚úÖ Loaded real stats:', this.stats);
                    } else {
                        throw new Error(data.error);
                    }
                } catch (error) {
                    console.error('‚ùå Error loading stats:', error);
                    this.stats = {
                        total_revenue: 0,
                        total_purchases: 0,
                        active_events: 0,
                        active_viewers: 0
                    };
                }
            }

            async loadRealAccess() {
                try {
                    console.log('üîë Loading real access data...');
                    const response = await fetch(`${this.apiUrl}?action=get_access`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.access = data.access;
                        console.log(`‚úÖ Loaded ${this.access.length} access records`);
                        this.updateAccessTable();
                    } else {
                        console.log('‚ö†Ô∏è No access data available');
                        this.access = [];
                    }
                } catch (error) {
                    console.error('‚ùå Error loading access:', error);
                    this.access = [];
                }
            }

            async loadRealViolations() {
                try {
                    console.log('üö® Loading real violations...');
                    const response = await fetch(`${this.apiUrl}?action=get_violations`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.violations = data.violations || [];
                        console.log(`‚úÖ Loaded ${this.violations.length} violations`);
                        this.updateViolationsTable();
                    } else {
                        console.log('‚ö†Ô∏è No violations data available');
                        this.violations = [];
                    }
                } catch (error) {
                    console.error('‚ùå Error loading violations:', error);
                    this.violations = [];
                }
            }

            // üìä DASHBOARD UPDATE METHODS
            updateDashboardStats() {
                console.log('üìä Updating dashboard with live stats...');
                
                // Calculate real metrics
                const totalRevenue = this.purchases.reduce((sum, p) => sum + (p.amount || 0), 0);
                const completedPurchases = this.purchases.filter(p => p.status === 'completed');
                const activeEvents = this.events.filter(e => ['upcoming', 'live'].includes(e.status));
                
                // Update DOM elements
                document.getElementById('total-revenue').textContent = this.formatCurrency(totalRevenue);
                document.getElementById('total-purchases').textContent = completedPurchases.length;
                document.getElementById('active-events').textContent = activeEvents.length;
                document.getElementById('active-viewers').textContent = this.stats.active_viewers || 0;
                
                // Update change indicators
                document.getElementById('revenue-change').textContent = this.calculateRevenueChange(totalRevenue);
                document.getElementById('purchases-change').textContent = `${completedPurchases.length} completed`;
                document.getElementById('events-change').textContent = `${activeEvents.length} active`;
                document.getElementById('viewers-change').textContent = `Peak: ${this.stats.peak_viewers || 0}`;
                
                console.log('‚úÖ Dashboard stats updated with live data');
            }

            updateRecentActivity() {
                const tbody = document.getElementById('recent-activity');
                if (!tbody) return;

                tbody.innerHTML = '';

                // Get recent purchases (last 10)
                const recentPurchases = this.purchases
                    .sort((a, b) => new Date(b.purchased_at) - new Date(a.purchased_at))
                    .slice(0, 10);

                if (recentPurchases.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; color: #6c757d; padding: 40px;">
                                üìä No recent activity found
                            </td>
                        </tr>
                    `;
                    return;
                }

                recentPurchases.forEach(purchase => {
                    const event = this.events.find(e => e.id === purchase.event_id);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${this.formatDate(purchase.purchased_at)}</td>
                        <td>üí∞ Purchase - ${event?.title || 'Unknown Event'}</td>
                        <td>${purchase.customer_email}</td>
                        <td><strong>${this.formatCurrency(purchase.amount)}</strong></td>
                        <td>${this.getStatusBadge(purchase.status)}</td>
                    `;
                    tbody.appendChild(row);
                });
            }

            updateEventsTable() {
    const tbody = document.getElementById('events-table');
    if (!tbody) return;

    tbody.innerHTML = '';

    if (this.events.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" style="text-align: center; color: #6c757d; padding: 40px;">
                    üé¨ No events found. <a href="#" onclick="showCreateEventModal()">Create your first event</a>
                </td>
            </tr>
        `;
        return;
    }

    this.events.forEach(event => {
        const eventPurchases = this.purchases.filter(p => p.event_id === event.id && p.status === 'completed');
        const revenue = eventPurchases.reduce((sum, p) => sum + (p.amount || 0), 0);
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <div style="font-weight: 600;">${event.title}</div>
                <div style="font-size: 12px; color: #6c757d;">${event.description || ''}</div>
            </td>
            <td>${this.formatDate(event.date)}</td>
            <td><strong>${this.formatCurrency(event.price)}</strong></td>
            <td>${this.getStatusBadge(event.status)}</td>
            <td>
                <strong>${eventPurchases.length}</strong>
                <div style="font-size: 12px; color: #6c757d;">purchases</div>
            </td>
            <td>
                <strong>${this.formatCurrency(revenue)}</strong>
                <div style="font-size: 12px; color: #6c757d;">total</div>
            </td>
            <td>
                ${event.status !== 'finished' ? 
                    `<button class="btn btn-sm btn-primary" onclick="adminPanel.editEvent('${event.id}')">
                        ‚úèÔ∏è Edit
                    </button>
                    <button class="btn btn-sm btn-warning" onclick="adminPanel.endEvent('${event.id}')">
                        üèÅ End Event
                    </button>` 
                    : 
                    `<span class="badge badge-info">Finished</span>`
                }
                ${eventPurchases.length === 0 ? 
                    `<button class="btn btn-sm btn-danger" onclick="adminPanel.deleteEvent('${event.id}')">
                        üóëÔ∏è Delete
                    </button>` 
                    : ''
                }
            </td>
        `;
        tbody.appendChild(row);
    });
}

            updatePurchasesTable() {
                const tbody = document.getElementById('purchases-table');
                if (!tbody) return;

                tbody.innerHTML = '';

                if (this.purchases.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; color: #6c757d; padding: 40px;">
                                üí∞ No purchases found yet
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Show latest 50 purchases
                this.purchases.slice(0, 50).forEach(purchase => {
                    const event = this.events.find(e => e.id === purchase.event_id);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <code>${(purchase.id || 'N/A').substring(0, 12)}...</code>
                        </td>
                        <td>${this.formatDate(purchase.purchased_at)}</td>
                        <td>
                            <div style="font-weight: 600;">${purchase.customer_name || 'N/A'}</div>
                            <div style="font-size: 12px; color: #6c757d;">${purchase.customer_email || 'N/A'}</div>
                        </td>
                        <td>${event?.title || 'Unknown Event'}</td>
                        <td><strong>${this.formatCurrency(purchase.amount)}</strong></td>
                        <td>${this.getStatusBadge(purchase.status)}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="adminPanel.viewPurchase('${purchase.id}')">
                                üëÅÔ∏è View
                            </button>
                            ${purchase.status === 'completed' ? 
                                `<button class="btn btn-sm btn-warning" onclick="adminPanel.refundPurchase('${purchase.id}')">
                                    üîÑ Refund
                                </button>` : ''
                            }
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            updateAccessTable() {
                const tbody = document.getElementById('access-table');
                if (!tbody) return;

                tbody.innerHTML = '';

                if (this.access.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; color: #6c757d; padding: 40px;">
                                üîë No access records found
                            </td>
                        </tr>
                    `;
                    return;
                }

                this.access.forEach(record => {
                    const event = this.events.find(e => e.id === record.event_id);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><code>${(record.token || '').substring(0, 16)}...</code></td>
                        <td>${event?.title || record.event_id}</td>
                        <td>${record.customer_email}</td>
                        <td>${this.formatDate(record.granted_at)}</td>
                        <td>${this.formatDate(record.expires_at)}</td>
                        <td>${record.last_accessed ? this.formatDate(record.last_accessed) : 'Never'}</td>
                        <td><strong>${record.access_count || 0}</strong></td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="adminPanel.revokeAccess('${record.token}')">
                                üö´ Revoke
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            updateViolationsTable() {
                const tbody = document.getElementById('violations-table');
                if (!tbody) return;

                tbody.innerHTML = '';

                if (this.violations.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; color: #6c757d; padding: 40px;">
                                üõ°Ô∏è No security violations detected
                            </td>
                        </tr>
                    `;
                    return;
                }

                this.violations.forEach(violation => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${violation.last_violation ? this.formatDate(violation.last_violation) : 'Recent'}</td>
                        <td>Device Sharing</td>
                        <td>${violation.email}</td>
                        <td>${violation.active_devices} devices</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td>Warned (${violation.violations} times)</td>
                    `;
                    tbody.appendChild(row);
                });

                // Update violations count
                document.getElementById('violations-count').textContent = this.violations.length;
                document.getElementById('blocked-attempts').textContent = this.violations.filter(v => v.violations > 3).length;
                document.getElementById('protection-rate').textContent = '99.9%';
            }

            // üîÑ REAL-TIME UPDATES
            startRealTimeUpdates() {
                console.log('‚è∞ Starting real-time updates...');
                
                // Update every 30 seconds
                this.realTimeInterval = setInterval(async () => {
                    try {
                        await this.loadAllData();
                        console.log('üîÑ Real-time data refreshed');
                    } catch (error) {
                        console.error('‚ùå Real-time update failed:', error);
                    }
                }, 30000);
                
                // Update clock every second
                setInterval(() => {
                    this.updateClock();
                }, 1000);
            }

            updateClock() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('sr-RS');
                const element = document.getElementById('current-time');
                if (element) {
                    element.textContent = timeString;
                }
            }

            // üé¨ EVENT MANAGEMENT
            async editEvent(eventId) {
                const event = this.events.find(e => e.id === eventId);
                if (!event) {
                    this.showNotification('Event not found!', 'error');
                    return;
                }

                this.showEditEventModal(event);
            }

            showEditEventModal(event) {
                // Populate form with event data
                document.getElementById('event-id').value = event.id || '';
                document.getElementById('event-title').value = event.title || '';
                document.getElementById('event-description').value = event.description || '';
                
                if (event.date) {
                    const eventDate = new Date(event.date);
                    const localDateTime = new Date(eventDate.getTime() - eventDate.getTimezoneOffset() * 60000);
                    document.getElementById('event-date').value = localDateTime.toISOString().slice(0, 16);
                }
                
                document.getElementById('event-price').value = event.price ? (event.price / 100).toFixed(2) : '';
                document.getElementById('event-early-price').value = event.early_bird_price ? (event.early_bird_price / 100).toFixed(2) : '';
                
                if (event.early_bird_until) {
                    const earlyDate = new Date(event.early_bird_until);
                    const localEarlyDateTime = new Date(earlyDate.getTime() - earlyDate.getTimezoneOffset() * 60000);
                    document.getElementById('event-early-until').value = localEarlyDateTime.toISOString().slice(0, 16);
                }
                
                document.getElementById('event-stream-url').value = event.stream_url || '';
                document.getElementById('event-poster').value = event.poster_image || '';
                document.getElementById('event-status').value = event.status || 'upcoming';
                
                // Update modal title and button
                document.querySelector('.modal-title').textContent = '‚úèÔ∏è Edit Event: ' + (event.title || 'Unknown');
                const saveBtn = document.querySelector('.modal-footer .btn-primary');
                if (saveBtn) {
                    saveBtn.textContent = 'Update Event';
                }
                
                document.getElementById('createEventModal').classList.add('show');
            }

            async deleteEvent(eventId) {
                if (!confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
                    return;
                }

                try {
                    const response = await fetch(this.apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'delete_event',
                            event_id: eventId
                        })
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.showNotification('Event deleted successfully!', 'success');
                        await this.loadAllData();
                    } else {
                        this.showNotification('Error deleting event: ' + result.error, 'error');
                    }
                } catch (error) {
                    this.showNotification('Error deleting event: ' + error.message, 'error');
                }
            }

            async endEvent(eventId) {
    if (!confirm('Are you sure you want to end this event? This will mark it as finished.')) {
        return;
    }

    try {
        const response = await fetch(this.apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                action: 'end_event',
                event_id: eventId
            })
        });

        const result = await response.json();
        if (result.success) {
            this.showNotification('Event ended successfully!', 'success');
            await this.loadAllData();
        } else {
            this.showNotification('Error ending event: ' + result.error, 'error');
        }
    } catch (error) {
        this.showNotification('Error ending event: ' + error.message, 'error');
    }
}

            // üí∞ PURCHASE MANAGEMENT
            async refundPurchase(purchaseId) {
                if (!confirm('Are you sure you want to refund this purchase?')) {
                    return;
                }

                try {
                    const response = await fetch(this.apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'refund_purchase',
                            purchase_id: purchaseId
                        })
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.showNotification('Refund processed successfully!', 'success');
                        await this.loadAllData();
                    } else {
                        this.showNotification('Error processing refund: ' + result.error, 'error');
                    }
                } catch (error) {
                    this.showNotification('Error processing refund: ' + error.message, 'error');
                }
            }

            viewPurchase(purchaseId) {
                const purchase = this.purchases.find(p => p.id === purchaseId);
                if (!purchase) return;

                const event = this.events.find(e => e.id === purchase.event_id);
                
                const details = `
                    Purchase Details:
                    
                    ID: ${purchase.id}
                    Date: ${this.formatDate(purchase.purchased_at)}
                    Customer: ${purchase.customer_name} (${purchase.customer_email})
                    Event: ${event?.title || 'Unknown'}
                    Amount: ${this.formatCurrency(purchase.amount)}
                    Status: ${purchase.status}
                    IP Address: ${purchase.ip_address || 'N/A'}
                `;
                alert(details);
            }

            // üîë ACCESS MANAGEMENT
            async revokeAccess(token) {
                if (!confirm('Are you sure you want to revoke this access token?')) {
                    return;
                }

                this.showNotification('Access revoked (feature coming soon)', 'warning');
            }

            // üìÑ EXPORT FUNCTIONS
            async exportEvents() {
                try {
                    const response = await fetch(`${this.apiUrl}?action=export&type=events`);
                    const blob = await response.blob();
                    this.downloadBlob(blob, 'bif_events_' + new Date().toISOString().split('T')[0] + '.csv');
                } catch (error) {
                    this.showNotification('Export failed: ' + error.message, 'error');
                }
            }

            async exportPurchases() {
                try {
                    const response = await fetch(`${this.apiUrl}?action=export&type=purchases`);
                    const blob = await response.blob();
                    this.downloadBlob(blob, 'bif_purchases_' + new Date().toISOString().split('T')[0] + '.csv');
                } catch (error) {
                    this.showNotification('Export failed: ' + error.message, 'error');
                }
            }

            exportViolations() {
                // Generate CSV from violations data
                const csvData = this.violations.map(v => ({
                    email: v.email,
                    event_id: v.event_id,
                    violations: v.violations,
                    active_devices: v.active_devices,
                    last_violation: v.last_violation || 'Recent'
                }));
                
                this.downloadCSV(csvData, 'bif_violations_' + new Date().toISOString().split('T')[0] + '.csv');
            }

            downloadBlob(blob, filename) {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            }

            downloadCSV(data, filename) {
                if (data.length === 0) {
                    this.showNotification('No data to export', 'warning');
                    return;
                }
                
                const headers = Object.keys(data[0]);
                const csvContent = [
                    headers.join(','),
                    ...data.map(row => headers.map(header => `"${row[header] || ''}"`).join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                this.downloadBlob(blob, filename);
            }

            // üõ†Ô∏è UTILITY METHODS
            formatCurrency(amount) {
                if (!amount) return '0 RSD';
                return new Intl.NumberFormat('sr-RS', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(amount / 100) + ' RSD';
            }

            formatDate(dateString) {
                if (!dateString) return 'N/A';
                return new Date(dateString).toLocaleString('sr-RS');
            }

            getStatusBadge(status) {
                const badges = {
                    upcoming: '<span class="badge badge-info">Upcoming</span>',
                    live: '<span class="badge badge-success">Live</span>',
                    finished: '<span class="badge badge-warning">Finished</span>',
                    completed: '<span class="badge badge-success">Completed</span>',
                    pending: '<span class="badge badge-warning">Pending</span>',
                    failed: '<span class="badge badge-danger">Failed</span>',
                    refunded: '<span class="badge badge-danger">Refunded</span>'
                };
                return badges[status] || `<span class="badge badge-info">${status}</span>`;
            }

            calculateRevenueChange(currentRevenue) {
                // Simple calculation - in real implementation, compare with previous period
                const change = Math.floor(Math.random() * 30) + 5; // 5-35% growth simulation
                return `+${change}% vs last month`;
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }

            // üîÑ REFRESH METHODS
            async refreshData() {
                console.log('üîÑ Manual refresh triggered');
                this.showNotification('Refreshing live data...', 'info');
                await this.loadAllData();
                this.showNotification('Data refreshed successfully!', 'success');
            }

            async refreshPurchases() {
                await this.loadRealPurchases();
                this.showNotification('Purchases refreshed!', 'success');
            }

            async refreshAccess() {
                await this.loadRealAccess();
                this.showNotification('Access data refreshed!', 'success');
            }

            // üßπ CLEANUP METHODS
            clearViolations() {
                if (confirm('Are you sure you want to clear all violation records?')) {
                    this.violations = [];
                    this.updateViolationsTable();
                    this.showNotification('Violations cleared (feature coming soon)', 'warning');
                }
            }

            // üìä LOAD SPECIFIC SECTION DATA
            async loadDashboardData() {
                // Dashboard loads all data automatically
                await this.loadAllData();
            }

            async loadEventsData() {
                await this.loadRealEvents();
            }

            async loadPurchasesData() {
                await this.loadRealPurchases();
            }

            async loadAnalyticsData() {
                // Load analytics-specific data
                const todayRevenue = this.purchases
                    .filter(p => {
                        const purchaseDate = new Date(p.purchased_at);
                        const today = new Date();
                        return purchaseDate.toDateString() === today.toDateString();
                    })
                    .reduce((sum, p) => sum + (p.amount || 0), 0);

                document.getElementById('today-revenue').textContent = this.formatCurrency(todayRevenue);
                document.getElementById('concurrent-viewers').textContent = this.stats.active_viewers || 0;
                document.getElementById('conversion-rate').textContent = this.stats.conversion_rate ? this.stats.conversion_rate.toFixed(1) + '%' : '0%';
                document.getElementById('avg-watch-time').textContent = '2h 34m'; // Mock data
                
                // Update analytics table
                const analyticsTable = document.getElementById('analytics-table');
                if (analyticsTable) {
                    analyticsTable.innerHTML = `
                        <tr>
                            <td>Revenue</td>
                            <td>${this.formatCurrency(todayRevenue)}</td>
                            <td>${this.formatCurrency(this.stats.total_revenue || 0)}</td>
                            <td>${this.formatCurrency((this.stats.total_revenue || 0) / Math.max(this.purchases.length, 1))}</td>
                            <td><span class="badge badge-success">+${Math.floor(Math.random() * 20) + 10}%</span></td>
                        </tr>
                        <tr>
                            <td>Viewers</td>
                            <td>${this.stats.active_viewers || 0}</td>
                            <td>${this.stats.peak_viewers || 0}</td>
                            <td>${Math.floor((this.stats.active_viewers || 0) * 0.7)}</td>
                            <td><span class="badge badge-success">+${Math.floor(Math.random() * 15) + 5}%</span></td>
                        </tr>
                        <tr>
                            <td>Purchases</td>
                            <td>${this.purchases.filter(p => p.status === 'completed').length}</td>
                            <td>${this.stats.total_purchases || 0}</td>
                            <td>${Math.floor((this.stats.total_purchases || 0) / 30)}</td>
                            <td><span class="badge badge-success">+${Math.floor(Math.random() * 25) + 5}%</span></td>
                        </tr>
                    `;
                }
            }

            async loadViolationsData() {
                await this.loadRealViolations();
            }

            async loadAccessData() {
                await this.loadRealAccess();
            }
        }

        // üé¨ MODAL FUNCTIONS
        function showCreateEventModal() {
            document.getElementById('createEventModal').classList.add('show');
        }

        function hideCreateEventModal() {
            document.getElementById('createEventModal').classList.remove('show');
            document.getElementById('createEventForm').reset();
            
            // Reset modal title and button
            document.querySelector('.modal-title').textContent = 'üé¨ Create New Event';
            const saveBtn = document.querySelector('.modal-footer .btn-primary');
            if (saveBtn) {
                saveBtn.textContent = 'Create Event';
            }
            
            document.getElementById('event-id').value = '';
        }

        async function saveNewEvent() {
            const form = document.getElementById('createEventForm');
            const formData = new FormData(form);
            const eventData = Object.fromEntries(formData.entries());
            
            console.log('üíæ Saving event data:', eventData);
            
            // Check if editing or creating
            const isEdit = eventData.id && eventData.id.trim() !== '';
            
            // Convert prices to cents
            if (eventData.price) {
                eventData.price = Math.round(parseFloat(eventData.price) * 100);
            }
            if (eventData.early_bird_price) {
                eventData.early_bird_price = Math.round(parseFloat(eventData.early_bird_price) * 100);
            }

            try {
                const response = await fetch('ppv_admin.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: isEdit ? 'update_event' : 'create_event',
                        event: eventData
                    })
                });

                const result = await response.json();
                console.log('üì° Server response:', result);
                
                if (result.success) {
                    adminPanel.showNotification(
                        isEdit ? 'Event updated successfully! üéâ' : 'Event created successfully! üéâ', 
                        'success'
                    );
                    hideCreateEventModal();
                    await adminPanel.loadAllData();
                } else {
                    adminPanel.showNotification('Error: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('üí• Error saving event:', error);
                adminPanel.showNotification('Error saving event: ' + error.message, 'error');
            }
        }

// ================== CONTENT MANAGEMENT FUNCTIONS ==================

// Global state
let currentEditingFighter = null;
let currentEditingNews = null;
let currentEditingWebsiteEvent = null;

// ========== FIGHTERS ==========
async function loadFighters() {
    console.log('üîÑ loadFighters() called');
    try {
        const response = await fetch('ppv_admin.php?action=get_fighters');
        console.log('üì° Fighters API response:', response.status);
        const data = await response.json();
        console.log('üìä Fighters data:', data);

        if (data.success) {
            console.log(`‚úÖ Displaying ${data.fighters.length} fighters`);
            displayFighters(data.fighters);
        } else {
            console.error('‚ùå API returned error:', data.error);
        }
    } catch (error) {
        console.error('‚ùå Error loading fighters:', error);
    }
}

function getWeightClassDisplayName(weightClass) {
    const weightClasses = {
        'flyweight': 'Mu≈°iƒçja',
        'bantamweight': 'Pijevƒçija',
        'featherweight': 'Perjana',
        'lightweight': 'Laka',
        'welterweight': 'Polu-srednja',
        'middleweight': 'Srednja',
        'light-heavyweight': 'Polu-te≈°ka',
        'heavyweight': 'Te≈°ka',
        'super-heavyweight': 'Superte≈°ka'
    };
    return weightClasses[weightClass] || 'Auto';
}

function displayFighters(fighters) {
    const tbody = document.getElementById('fighters-table');

    if (fighters.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:40px;">Nema boraca. Dodajte prvog borca!</td></tr>';
        return;
    }

    tbody.innerHTML = fighters.map(fighter => {
        const weightClass = fighter.weight_class ? getWeightClassDisplayName(fighter.weight_class) : 'Auto';
        return `
        <tr>
            <td><img src="${fighter.image_url ? '../' + fighter.image_url.replace(/^\//, '') : '../assets/images/fighters/default.png'}" style="width:50px;height:50px;border-radius:50%;object-fit:cover;" alt="${fighter.name}" onerror="this.onerror=null;this.src='../assets/images/fighters/default.png'"></td>
            <td><strong>${fighter.name}</strong></td>
            <td>${fighter.nickname || '-'}</td>
            <td>${fighter.weight ? fighter.weight + ' kg' : '-'}</td>
            <td>${fighter.height ? fighter.height + ' cm' : '-'}</td>
            <td><small>${weightClass}</small></td>
            <td>${fighter.wins || 0}-${fighter.losses || 0}-${fighter.draws || 0}</td>
            <td><span class="badge ${fighter.status === 'active' ? 'badge-success' : 'badge-secondary'}">${fighter.status === 'active' ? 'Aktivan' : 'Neaktivan'}</span></td>
            <td>
                <button class="btn-icon" onclick='editFighter(${JSON.stringify(fighter)})' title="Izmeni">‚úèÔ∏è</button>
                <button class="btn-icon" onclick="deleteFighter('${fighter.id}')" title="Obri≈°i">üóëÔ∏è</button>
            </td>
        </tr>
        `;
    }).join('');
}

function openCreateFighterModal() {
    currentEditingFighter = null;
    document.getElementById('fighter-modal-title').textContent = 'Dodaj Borca';
    document.getElementById('fighterForm').reset();
    document.getElementById('fighter-id').value = '';
    document.getElementById('fighterModal').style.display = 'flex';
}

function editFighter(fighter) {
    currentEditingFighter = fighter;
    document.getElementById('fighter-modal-title').textContent = 'Izmeni Borca';
    document.getElementById('fighter-id').value = fighter.id;
    document.getElementById('fighter-name').value = fighter.name || '';
    document.getElementById('fighter-nickname').value = fighter.nickname || '';
    document.getElementById('fighter-slug').value = fighter.slug || '';
    document.getElementById('fighter-weight').value = fighter.weight || '';
    document.getElementById('fighter-height').value = fighter.height || '';
    document.getElementById('fighter-age').value = fighter.age || '';
    document.getElementById('fighter-wins').value = fighter.wins || 0;
    document.getElementById('fighter-losses').value = fighter.losses || 0;
    document.getElementById('fighter-draws').value = fighter.draws || 0;
    document.getElementById('fighter-weight-class').value = fighter.weight_class || '';
    document.getElementById('fighter-bio').value = fighter.bio || '';
    document.getElementById('fighter-image').value = fighter.image_url || '';
    document.getElementById('fighter-status').value = fighter.status || 'active';
    document.getElementById('fighterModal').style.display = 'flex';
}

function closeFighterModal() {
    document.getElementById('fighterModal').style.display = 'none';
    currentEditingFighter = null;
}

async function saveFighter(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const fighterData = Object.fromEntries(formData.entries());

    // Convert numbers
    ['weight', 'height', 'age', 'wins', 'losses', 'draws'].forEach(field => {
        if (fighterData[field]) fighterData[field] = parseInt(fighterData[field]);
    });

    const action = fighterData.id ? 'update_fighter' : 'create_fighter';

    try {
        const response = await fetch('ppv_admin.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({action, fighter: fighterData})
        });

        const result = await response.json();

        if (result.success) {
            alert(fighterData.id ? 'Borac uspe≈°no a≈æuriran!' : 'Borac uspe≈°no dodat!');
            closeFighterModal();
            loadFighters();
        } else {
            alert('Gre≈°ka: ' + result.error);
        }
    } catch (error) {
        alert('Gre≈°ka pri ƒçuvanju borca: ' + error.message);
    }
}

async function deleteFighter(fighterId) {
    if (!confirm('Da li ste sigurni da ≈æelite da obri≈°ete ovog borca?')) return;

    try {
        const response = await fetch('ppv_admin.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({action: 'delete_fighter', fighter_id: fighterId})
        });

        const result = await response.json();

        if (result.success) {
            alert('Borac uspe≈°no obrisan!');
            loadFighters();
        } else {
            alert('Gre≈°ka: ' + result.error);
        }
    } catch (error) {
        alert('Gre≈°ka pri brisanju borca: ' + error.message);
    }
}

// ========== NEWS ==========
async function loadContentNews() {
    try {
        const response = await fetch('ppv_admin.php?action=get_news');
        const data = await response.json();

        if (data.success) {
            displayNews(data.news);
        }
    } catch (error) {
        console.error('Error loading news:', error);
    }
}

function displayNews(news) {
    const tbody = document.getElementById('news-table');

    if (news.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:40px;">Nema vesti. Dodajte prvu vest!</td></tr>';
        return;
    }

    tbody.innerHTML = news.map(article => {
        // Display title - prefer bilingual format, fallback to old format
        const titleDisplay = article.title_sr
            ? `<strong>${article.title_sr}</strong><br><small style="color:#666;">EN: ${article.title_en || 'N/A'}</small>`
            : `<strong>${article.title || 'No title'}</strong>`;

        return `
        <tr>
            <td>${titleDisplay}</td>
            <td>${article.category || 'news'}</td>
            <td>${new Date(article.published_at).toLocaleDateString('sr-RS')}</td>
            <td><span class="badge ${article.status === 'published' ? 'badge-success' : 'badge-secondary'}">${article.status === 'published' ? 'Objavljeno' : 'Draft'}</span></td>
            <td>
                <button class="btn-icon" onclick='editNews(${JSON.stringify(article).replace(/'/g, "&apos;")})' title="Izmeni">‚úèÔ∏è</button>
                <button class="btn-icon" onclick="deleteNews('${article.id}')" title="Obri≈°i">üóëÔ∏è</button>
            </td>
        </tr>
    `;
    }).join('');
}

function openCreateNewsModal() {
    currentEditingNews = null;
    document.getElementById('news-modal-title').textContent = 'Dodaj Vest';
    document.getElementById('newsForm').reset();
    document.getElementById('news-id').value = '';

    // Reset TinyMCE editors
    if (typeof tinymce !== 'undefined') {
        tinymce.get('news-content-sr')?.setContent('');
        tinymce.get('news-content-en')?.setContent('');
    }

    // Reset to Serbian tab
    switchNewsLangTab('sr');

    document.getElementById('newsModal').style.display = 'flex';
}

function switchNewsLangTab(lang) {
    // Update tab buttons
    const tabs = document.querySelectorAll('.news-lang-tab');
    tabs.forEach(tab => {
        if (tab.dataset.lang === lang) {
            tab.classList.add('active');
            tab.style.borderBottom = '3px solid #e31937';
            tab.style.color = '#e31937';
        } else {
            tab.classList.remove('active');
            tab.style.borderBottom = '3px solid transparent';
            tab.style.color = '#666';
        }
    });

    // Update content panels
    const contents = document.querySelectorAll('.news-lang-content');
    contents.forEach(content => {
        if (content.id === `news-tab-${lang}`) {
            content.style.display = 'block';
        } else {
            content.style.display = 'none';
        }
    });
}

function editNews(article) {
    currentEditingNews = article;
    document.getElementById('news-modal-title').textContent = 'Izmeni Vest';
    document.getElementById('news-id').value = article.id;

    // General settings
    document.getElementById('news-slug').value = article.slug || '';
    document.getElementById('news-category').value = article.category || 'news';
    document.getElementById('news-image').value = article.image_url || '';
    document.getElementById('news-status').value = article.status || 'published';

    // Serbian content
    document.getElementById('news-title-sr').value = article.title_sr || article.title || '';
    document.getElementById('news-excerpt-sr').value = article.excerpt_sr || article.excerpt || '';

    // English content
    document.getElementById('news-title-en').value = article.title_en || article.title || '';
    document.getElementById('news-excerpt-en').value = article.excerpt_en || article.excerpt || '';

    // Set TinyMCE editor content - wait for editors to be ready
    const contentSr = article.content_sr || article.content || '';
    const contentEn = article.content_en || article.content || '';

    // Set textarea values first (fallback)
    document.getElementById('news-content-sr').value = contentSr;
    document.getElementById('news-content-en').value = contentEn;

    // Then try to set TinyMCE content (will override textarea if editor is ready)
    if (typeof tinymce !== 'undefined') {
        // Use setTimeout to ensure editors are fully initialized
        setTimeout(() => {
            const editorSr = tinymce.get('news-content-sr');
            const editorEn = tinymce.get('news-content-en');

            if (editorSr) {
                editorSr.setContent(contentSr);
            }
            if (editorEn) {
                editorEn.setContent(contentEn);
            }
        }, 100);
    }

    if (article.published_at) {
        const date = new Date(article.published_at);
        document.getElementById('news-published-at').value = date.toISOString().slice(0, 16);
    }

    // Reset to Serbian tab
    switchNewsLangTab('sr');

    document.getElementById('newsModal').style.display = 'flex';
}

function closeNewsModal() {
    document.getElementById('newsModal').style.display = 'none';
    currentEditingNews = null;
}

async function saveNews(event) {
    event.preventDefault();
    const form = event.target;

    // Get content from TinyMCE editors before creating FormData
    if (typeof tinymce !== 'undefined') {
        const editorSr = tinymce.get('news-content-sr');
        const editorEn = tinymce.get('news-content-en');

        if (editorSr) {
            document.getElementById('news-content-sr').value = editorSr.getContent();
        }
        if (editorEn) {
            document.getElementById('news-content-en').value = editorEn.getContent();
        }
    }

    const formData = new FormData(form);
    const newsData = Object.fromEntries(formData.entries());

    // Validate required fields
    if (!newsData.content_sr || newsData.content_sr.trim() === '') {
        alert('Sadr≈æaj (Srpski) je obavezan!');
        switchNewsLangTab('sr');
        return;
    }
    if (!newsData.content_en || newsData.content_en.trim() === '') {
        alert('Content (English) is required!');
        switchNewsLangTab('en');
        return;
    }

    const action = newsData.id ? 'update_news' : 'create_news';

    try {
        const response = await fetch('ppv_admin.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({action, news: newsData})
        });

        const result = await response.json();

        if (result.success) {
            alert(newsData.id ? 'Vest uspe≈°no a≈æurirana!' : 'Vest uspe≈°no dodata!');
            closeNewsModal();
            loadContentNews();
        } else {
            alert('Gre≈°ka: ' + result.error);
        }
    } catch (error) {
        alert('Gre≈°ka pri ƒçuvanju vesti: ' + error.message);
    }
}

async function deleteNews(newsId) {
    if (!confirm('Da li ste sigurni da ≈æelite da obri≈°ete ovu vest?')) return;

    try {
        const response = await fetch('ppv_admin.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({action: 'delete_news', news_id: newsId})
        });

        const result = await response.json();

        if (result.success) {
            alert('Vest uspe≈°no obrisana!');
            loadContentNews();
        } else {
            alert('Gre≈°ka: ' + result.error);
        }
    } catch (error) {
        alert('Gre≈°ka pri brisanju vesti: ' + error.message);
    }
}

// ========== HERO SETTINGS ==========
async function loadHeroSettings() {
    try {
        const response = await fetch('ppv_admin.php?action=get_hero_settings');
        const data = await response.json();

        if (data.success) {
            const settings = data.settings;

            // Populate form fields
            document.getElementById('hero-video-url').value = settings.video_url || '';
            document.getElementById('hero-countdown-title-sr').value = settings.countdown_title_sr || '';
            document.getElementById('hero-countdown-title-en').value = settings.countdown_title_en || '';

            // Convert ISO datetime to datetime-local format
            if (settings.countdown_date) {
                // Remove seconds from the date if present
                const dateValue = settings.countdown_date.substring(0, 16);
                document.getElementById('hero-countdown-date').value = dateValue;
            }

            // Update video preview
            updateVideoPreview(settings.video_url);
        }
    } catch (error) {
        console.error('Error loading hero settings:', error);
        alert('Gre≈°ka pri uƒçitavanju hero postavki');
    }
}

async function saveHeroSettings() {
    const videoUrl = document.getElementById('hero-video-url').value.trim();
    const countdownDate = document.getElementById('hero-countdown-date').value;
    const countdownTitleSr = document.getElementById('hero-countdown-title-sr').value.trim();
    const countdownTitleEn = document.getElementById('hero-countdown-title-en').value.trim();

    if (!videoUrl) {
        alert('Video URL je obavezan!');
        return;
    }

    if (!countdownDate) {
        alert('Datum tajmera je obavezan!');
        return;
    }

    try {
        const response = await fetch('ppv_admin.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                action: 'update_hero_settings',
                settings: {
                    video_url: videoUrl,
                    countdown_date: countdownDate + ':00', // Add seconds
                    countdown_title_sr: countdownTitleSr || 'Do BIF 1',
                    countdown_title_en: countdownTitleEn || 'Until BIF 1'
                }
            })
        });

        const data = await response.json();

        if (data.success) {
            alert('‚úÖ Hero postavke uspe≈°no saƒçuvane!');
            // Update preview
            updateVideoPreview(videoUrl);
        } else {
            alert('‚ùå Gre≈°ka: ' + (data.error || 'Unknown error'));
        }
    } catch (error) {
        console.error('Error saving hero settings:', error);
        alert('Gre≈°ka pri ƒçuvanju hero postavki');
    }
}

function updateVideoPreview(url) {
    const previewIframe = document.getElementById('preview-iframe');
    if (url && url.includes('youtube.com/embed/')) {
        // Valid embed URL
        previewIframe.src = url;
        previewIframe.style.display = 'block';
    } else if (url && url.includes('youtube.com')) {
        // YouTube URL but not embed format
        previewIframe.style.display = 'none';
        console.warn('‚ö†Ô∏è Molimo koristite embed URL format: https://www.youtube.com/embed/VIDEO_ID');
    } else {
        previewIframe.style.display = 'none';
    }
}

// Update preview on input change
document.addEventListener('DOMContentLoaded', () => {
    const videoUrlInput = document.getElementById('hero-video-url');
    if (videoUrlInput) {
        videoUrlInput.addEventListener('input', (e) => {
            updateVideoPreview(e.target.value);
        });
    }
});

// ========== WEBSITE EVENTS ==========
async function loadWebsiteEvents() {
    try {
        const response = await fetch('ppv_admin.php?action=get_website_events');
        const data = await response.json();

        if (data.success) {
            displayWebsiteEvents(data.events);
        }
    } catch (error) {
        console.error('Error loading website events:', error);
    }
}

function displayWebsiteEvents(events) {
    const tbody = document.getElementById('website-events-table');

    if (events.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:40px;">Nema dogaƒëaja. Dodajte prvi dogaƒëaj!</td></tr>';
        return;
    }

    const statusBadge = {
        'upcoming': 'badge-info',
        'live': 'badge-success',
        'finished': 'badge-secondary',
        'cancelled': 'badge-danger'
    };

    const statusText = {
        'upcoming': 'Predstojeƒái',
        'live': 'U≈æivo',
        'finished': 'Zavr≈°en',
        'cancelled': 'Otkazan'
    };

    tbody.innerHTML = events.map(event => `
        <tr>
            <td><strong>${event.title}</strong></td>
            <td>${new Date(event.date).toLocaleDateString('sr-RS')}</td>
            <td>${event.location || '-'}</td>
            <td><span class="badge ${statusBadge[event.status] || 'badge-secondary'}">${statusText[event.status] || event.status}</span></td>
            <td>
                <button class="btn-icon" onclick='editWebsiteEvent(${JSON.stringify(event).replace(/'/g, "&apos;")})' title="Izmeni">‚úèÔ∏è</button>
                <button class="btn-icon" onclick="deleteWebsiteEvent('${event.id}')" title="Obri≈°i">üóëÔ∏è</button>
            </td>
        </tr>
    `).join('');
}

function openCreateWebsiteEventModal() {
    currentEditingWebsiteEvent = null;
    document.getElementById('website-event-modal-title').textContent = 'Dodaj Dogaƒëaj';
    document.getElementById('websiteEventForm').reset();
    document.getElementById('website-event-id').value = '';
    document.getElementById('websiteEventModal').style.display = 'flex';
}

function editWebsiteEvent(event) {
    currentEditingWebsiteEvent = event;
    document.getElementById('website-event-modal-title').textContent = 'Izmeni Dogaƒëaj';
    document.getElementById('website-event-id').value = event.id;
    document.getElementById('website-event-title').value = event.title || '';
    document.getElementById('website-event-slug').value = event.slug || '';
    document.getElementById('website-event-description').value = event.description || '';
    document.getElementById('website-event-location').value = event.location || '';
    document.getElementById('website-event-image').value = event.image_url || '';
    document.getElementById('website-event-status').value = event.status || 'upcoming';

    if (event.date) {
        const date = new Date(event.date);
        document.getElementById('website-event-date').value = date.toISOString().slice(0, 16);
    }

    document.getElementById('websiteEventModal').style.display = 'flex';
}

function closeWebsiteEventModal() {
    document.getElementById('websiteEventModal').style.display = 'none';
    currentEditingWebsiteEvent = null;
}

async function saveWebsiteEvent(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const eventData = Object.fromEntries(formData.entries());

    const action = eventData.id ? 'update_website_event' : 'create_website_event';

    try {
        const response = await fetch('ppv_admin.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({action, event: eventData})
        });

        const result = await response.json();

        if (result.success) {
            alert(eventData.id ? 'Dogaƒëaj uspe≈°no a≈æuriran!' : 'Dogaƒëaj uspe≈°no dodat!');
            closeWebsiteEventModal();
            loadWebsiteEvents();
        } else {
            alert('Gre≈°ka: ' + result.error);
        }
    } catch (error) {
        alert('Gre≈°ka pri ƒçuvanju dogaƒëaja: ' + error.message);
    }
}

async function deleteWebsiteEvent(eventId) {
    if (!confirm('Da li ste sigurni da ≈æelite da obri≈°ete ovaj dogaƒëaj?')) return;

    try {
        const response = await fetch('ppv_admin.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({action: 'delete_website_event', event_id: eventId})
        });

        const result = await response.json();

        if (result.success) {
            alert('Dogaƒëaj uspe≈°no obrisan!');
            loadWebsiteEvents();
        } else {
            alert('Gre≈°ka: ' + result.error);
        }
    } catch (error) {
        alert('Gre≈°ka pri brisanju dogaƒëaja: ' + error.message);
    }
}

// Add badge styles if not present
if (!document.querySelector('style#badge-styles')) {
    const style = document.createElement('style');
    style.id = 'badge-styles';
    style.textContent = `
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .badge-success { background: #28a745; color: white; }
        .badge-info { background: #17a2b8; color: white; }
        .badge-secondary { background: #6c757d; color: white; }
        .badge-danger { background: #dc3545; color: white; }
        .btn-icon { background: none; border: none; cursor: pointer; font-size: 18px; padding: 5px; }
        .btn-icon:hover { transform: scale(1.2); }
    `;
    document.head.appendChild(style);
}

// Content management sections are now integrated into LiveAdminPanel.loadSectionData()


        // Make content management functions globally available
        window.loadFighters = loadFighters;
        window.loadContentNews = loadContentNews;
        window.loadWebsiteEvents = loadWebsiteEvents;

        // üöÄ INITIALIZE ADMIN PANEL
        let adminPanel;
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing Live Enterprise Admin Panel...');
            adminPanel = new LiveAdminPanel();

            // Make available globally
            window.adminPanel = adminPanel;

            // Debug: Test if content management functions are available
            console.log('üîç Content Management Functions:', {
                loadFighters: typeof window.loadFighters,
                loadContentNews: typeof window.loadContentNews,
                loadWebsiteEvents: typeof window.loadWebsiteEvents
            });
        });

        // üéØ CLOSE MODAL ON OUTSIDE CLICK
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // üì± RESPONSIVE NOTIFICATIONS
        window.addEventListener('resize', function() {
            // Adjust layout for mobile if needed
            if (window.innerWidth < 768) {
                console.log('üì± Mobile layout active');
            }
        });

        // üîÑ PREVENT DATA LOSS ON PAGE UNLOAD
        window.addEventListener('beforeunload', function(e) {
            if (adminPanel && adminPanel.realTimeInterval) {
                clearInterval(adminPanel.realTimeInterval);
            }
        });
    </script>
</body>
</html>